{% block content %}
<div class="bg-gray-900 p-8">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-2xl font-bold text-white">User Management</h1>
      <div class="relative">
        <input
          type="text"
          placeholder="Search users..."
          class="bg-gray-800 text-white px-4 py-2 pl-10 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 w-64"
        />
        <i class="fas fa-search absolute left-3 top-3 text-gray-500"></i>
      </div>
    </div>

    <!-- Table -->
    <div class="bg-gray-800 rounded-xl overflow-hidden shadow-lg">
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-700">
          <tr>
            <th
              scope="col"
              class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              User
            </th>
            <th
              scope="col"
              class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Email
            </th>
            <th
              scope="col"
              class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Role
            </th>
            <th
              scope="col"
              class="px-6 py-4 text-right text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-gray-800 divide-y divide-gray-700">
          {% for user in all_users %}
          <tr class="hover:bg-gray-750 transition-colors duration-150">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div
  class="flex-shrink-0 h-10 w-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold uppercase"
>
  {{ user.first_name|slice:":1" }}{{ user.first_name|slice:"-1:" }}
</div>


                <div class="ml-4">
                  <div class="text-sm font-medium text-white">
                    {{user.first_name}}
                  </div>
                  <div class="text-sm text-gray-400">@{{user.username}}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-white">{{user.email}}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-900 text-green-300"
                >{{user.role}}</span
              >
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
            >
              <button
                onclick="openModal({{ user.id }}, '{{ user.first_name }}', '{{ user.email }}', '{{ user.role }}')"
                class="text-purple-400 hover:text-purple-300 mr-3"
              >
                <i class="fas fa-eye"></i>
              </button>
              <button
                onclick="deleteUser({{ user.id }})"
                class="text-red-400 hover:text-red-300"
              >
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-between mt-6">
      <div class="text-sm text-gray-400">
        Showing <span class="font-medium text-white">1</span> to
        <span class="font-medium text-white">3</span> of
        <span class="font-medium text-white">24</span> users
      </div>
      <div class="flex space-x-2">
        <button
          class="px-3 py-1 rounded-md bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"
        >
          Previous
        </button>
        <button class="px-3 py-1 rounded-md bg-purple-600 text-white">1</button>
        <button
          class="px-3 py-1 rounded-md bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"
        >
          2
        </button>
        <button
          class="px-3 py-1 rounded-md bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"
        >
          3
        </button>
        <button
          class="px-3 py-1 rounded-md bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"
        >
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div
    id="userModal"
    class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden"
  >
    <div
      class="bg-gray-800 rounded-xl max-w-md w-full mx-4 shadow-2xl overflow-hidden transform transition-all"
    >
      <div class="p-6">
        <div class="flex justify-between items-start">
          <h3 class="text-xl font-bold text-white">User Details</h3>
          <button onclick="closeModal()" class="text-gray-400 hover:text-white">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="mt-6">
          <div class="flex justify-center mb-6">
            <div
              id="userInitials"
              class="h-20 w-20 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white text-2xl font-bold uppercase"
            > {{ user.first_name|slice:":1" }}{{ user.first_name|slice:"-1:" }}</div>
            
          </div>

          <div class="space-y-4">
            <div>
              <p class="text-sm text-gray-400">Full Name</p>
              <p id="modalUsername" class="text-lg text-white font-medium"></p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Email</p>
              <p id="modalEmail" class="text-lg text-white font-medium"></p>
            </div>
            <div class="flex space-x-4">
              <div class="flex-1">
                <p class="text-sm text-gray-400">Role</p>
                <select
                  id="modalRoleSelect"
                  class="mt-1 block w-full bg-gray-700 text-white border-gray-600 rounded-md"
                >
                  <option value="user">User</option>
                  <option value="vendor">Vendor</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="flex-1">
                <p class="text-sm text-gray-400">Status</p>
                <p id="modalStatus" class="text-lg text-white font-medium"></p>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-8 flex justify-end space-x-3">
          <button
            onclick="closeModal()"
            class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors"
          >
            Close
          </button>
          <button
            onclick="updateUserRole()"
            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
          >
            Update Role
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  let selectedUserId = null;

  function openModal(id, name, email, role) {
    selectedUserId = id;
    document.getElementById("modalUsername").innerText = name;
    document.getElementById("modalEmail").innerText = email;
    document.getElementById("modalRoleSelect").value = role;
    document.getElementById("userModal").classList.remove("hidden");
  }

  function closeModal() {
    selectedUserId = null;
    document.getElementById("userModal").classList.add("hidden");
  }

  function updateUserRole() {
    const newRole = document.getElementById("modalRoleSelect").value;

    fetch(`/users/${selectedUserId}/update-role/`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCSRFToken(),
      },
      body: JSON.stringify({ role: newRole }),
    }).then((response) => {
      if (response.ok) {
        alert("User role updated!");
        location.reload();
      } else {
        return response.json().then((data) => {
          alert("Error: " + JSON.stringify(data));
        });
      }
    });
  }

  function deleteUser(userId) {
    if (!confirm("Are you sure you want to delete this user?")) return;

    fetch(`/users/${userId}/delete/`, {
      method: "DELETE",
      headers: {
        "X-CSRFToken": getCSRFToken(),
      },
    }).then((response) => {
      if (response.ok) {
        alert("User deleted successfully.");
        location.reload();
      } else {
        return response.json().then((data) => {
          alert("Error: " + JSON.stringify(data));
        });
      }
    });
  }

  function getCSRFToken() {
    const name = "csrftoken";
    const cookies = document.cookie.split(";");
    for (let cookie of cookies) {
      const [key, val] = cookie.trim().split("=");
      if (key === name) return decodeURIComponent(val);
    }
    return "";
  }
</script>

{% endblock %}
