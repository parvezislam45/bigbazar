{% extends "base.html" %} {% block content %}
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: "#6366f1",
          secondary: "#8b5cf6",
          dark: "#1e293b",
          light: "#f1f5f9",
          accent: "#0ea5e9",
        },
        animation: {
          "slide-in": "slideIn 0.3s ease-in-out",
          "slide-out": "slideOut 0.3s ease-in-out",
          "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
        },
        keyframes: {
          slideIn: {
            "0%": { transform: "translateX(-100%)" },
            "100%": { transform: "translateX(0)" },
          },
          slideOut: {
            "0%": { transform: "translateX(0)" },
            "100%": { transform: "translateX(-100%)" },
          },
        },
      },
    },
  };
</script>
<style>
  @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

  body {
    font-family: "Inter", sans-serif;
    background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
    min-height: 100vh;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  .sidebar {
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
    box-shadow: 0 0 35px rgba(0, 0, 0, 0.1);
    z-index: 100;
    backdrop-filter: blur(10px);
    background: rgba(30, 41, 59, 0.95);
  }

  .nav-item {
    transition: all 0.3s ease;
    border-radius: 12px;
    position: relative;
    overflow: hidden;
  }

  .nav-item:hover {
    background: rgba(99, 102, 241, 0.15);
    transform: translateX(5px);
  }

  .nav-item:hover::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    height: 50%;
    width: 4px;
    background: #6366f1;
    border-radius: 0 8px 8px 0;
  }

  .nav-item.active {
    background: rgba(99, 102, 241, 0.2);
  }

  .nav-item.active .nav-icon {
    transform: scale(1.1);
    color: #6366f1;
  }

  .nav-icon {
    transition: all 0.3s ease;
  }

  .sub-menu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
  }

  .sub-menu.open {
    max-height: 500px;
  }

  .sub-item {
    transition: all 0.2s ease;
  }

  .sub-item:hover {
    background: rgba(99, 102, 241, 0.1);
    transform: translateX(8px);
  }

  .profile-avatar {
    transition: all 0.3s ease;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
  }

  .profile-avatar:hover {
    transform: scale(1.05);
    box-shadow: 0 0 0 5px rgba(99, 102, 241, 0.7);
  }

  .toggle-btn {
    transition: all 0.3s ease;
  }

  .toggle-btn:hover {
    transform: rotate(180deg);
    background: rgba(99, 102, 241, 0.2);
  }

  .notification-badge {
    animation: pulse-slow 3s infinite;
  }

  .sidebar.collapsed .nav-text {
    opacity: 0;
    width: 0;
    pointer-events: none;
  }

  .sidebar.collapsed {
    width: 80px;
  }

  .sidebar.collapsed .logo-text {
    opacity: 0;
  }

  .sidebar.collapsed .profile-info {
    opacity: 0;
    height: 0;
    padding: 0;
  }

  .sidebar.collapsed .toggle-btn {
    transform: rotate(180deg);
  }

  .dropdown-icon {
    transition: transform 0.3s ease;
  }

  .rotate-180 {
    transform: rotate(180deg);
  }

  .submenu-trigger {
    cursor: pointer;
  }
</style>
<div class="flex">
  <!-- Sidebar -->
  <aside class="sidebar min-h-screen w-64 fixed text-light flex flex-col justify-between py-6">
    <!-- Top Section -->
    <div>
      <!-- Logo -->
      <div class="flex items-center justify-between px-6 mb-8">
        <div class="flex items-center space-x-3">
          <div class="bg-primary p-2 rounded-xl shadow-lg">
            <i class="fas fa-chart-network text-white text-sm rounded-full"></i>
          </div>
          <span class="logo-text text-md font-bold text-white transition-opacity">Dashboard</span>
        </div>
        <button id="toggleBtn" class="toggle-btn bg-dark border border-slate-600 text-slate-300 rounded-full p-2 hover:bg-slate-700">
          <i class="fas fa-angle-left"></i>
        </button>
      </div>

      <!-- Navigation -->
      <nav class="px-4">
        <!-- Products -->
         {% if request.user.role == 'admin' or request.user.role == 'vendor' %}
        <div class="nav-item py-2 px-4 submenu-trigger">
          <div class="flex items-center space-x-3">
            <i class="nav-icon fas fa-home text-lg text-primary"></i>
            <span class="nav-text">Products</span>
            <i class="dropdown-icon fas fa-chevron-down text-xs ml-auto transition-transform"></i>
          </div>
          <div class="sub-menu mt-2 ml-8">
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'add-product-page' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'add-product-page' %}"
                 class="text-sm font-semibold block">
                Add Product
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'all-product' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'all-product' %}"
                 class="text-sm font-semibold block">
                All Product
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'add-category' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'add-category' %}"
                 class="text-sm font-semibold block">
                Add Category
              </a>
            </div>
          </div>
        </div>

        <!-- Orders -->
        <div class="nav-item py-2 px-4 submenu-trigger">
          <div class="flex items-center space-x-3">
            <i class="nav-icon fa-brands fa-jedi-order text-xl text-violet-500"></i>
            <span class="nav-text">Orders</span>
            <i class="dropdown-icon fas fa-chevron-down text-xs ml-auto transition-transform"></i>
          </div>
          <div class="sub-menu mt-2 ml-8">
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'orders' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'orders' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-border-all text-xl text-green-600"></i>
                  <span class="absolute -top-1 -right-2 bg-amber-700 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">All Orders</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'pending' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'pending' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-spinner text-xl text-orange-500"></i>
                  <span class="absolute -top-1 -right-2 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Pending</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'received' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'received' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-satellite-dish text-xl text-teal-500"></i>
                  <span class="absolute -top-1 -right-2 bg-sky-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Received</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'transit' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'transit' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-truck-fast text-xl text-sky-500"></i>
                  <span class="absolute -top-1 -right-2 bg-pink-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Transit</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'processing' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'processing' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-hands-asl-interpreting text-xl text-yellow-500"></i>
                  <span class="absolute -top-1 -right-2 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Processing</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'delivered' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'delivered' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-truck-front text-xl text-purple-500"></i>
                  <span class="absolute -top-1 -right-2 bg-fuchsia-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_order_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Delivered</span>
              </a>
            </div>
          </div>
        </div>
        {% endif %}
         {% if request.user.role == 'admin' %}
        <div class="nav-item py-2 px-4 submenu-trigger">
          <div class="flex items-center space-x-3">
            <i class="nav-icon fa-brands fa-jedi-order text-xl text-violet-500"></i>
            <span class="nav-text">Vendors</span>
            <i class="dropdown-icon fas fa-chevron-down text-xs ml-auto transition-transform"></i>
          </div>
          <div class="sub-menu mt-2 ml-8">
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'all_vendor' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'all_vendor' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-border-all text-xl text-green-600"></i>
                  <span class="absolute -top-1 -right-2 bg-amber-700 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ total_vendor_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">All Vendors</span>
              </a>
            </div>
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'vendor_request' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'vendor_request' %}"
                 class="flex items-center space-x-5 relative">
                <div class="relative">
                  <i class="fa-solid fa-spinner text-xl text-orange-500"></i>
                  <span class="absolute -top-1 -right-2 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs">
                    {{ pending_vendor_count }}
                  </span>
                </div>
                <span class="nav-text text-white text-sm font-bold">Pending Request</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Users -->
        <div class="nav-item py-2 px-4 submenu-trigger">
          <div class="flex items-center space-x-3">
            <i class="nav-icon fas fa-cog text-lg text-yellow-400"></i>
            <span class="nav-text">Users</span>
            <i class="dropdown-icon fas fa-chevron-down text-xs ml-auto transition-transform"></i>
          </div>
          <div class="sub-menu mt-2 ml-8">
            <div class="sub-item py-2 px-4 rounded-lg hover:bg-slate-700 mb-1">
              <a hx-get="{% url 'all_users' %}"
                 hx-target="#content"
                 hx-swap="innerHTML"
                 onclick="navigateAndSave(this)"
                 data-url="{% url 'all_users' %}"
                 class="text-sm font-semibold block">
                All Users
              </a>
            </div>
          </div>
        </div>
        {% endif %}
      </nav>

      <!-- Profile Section -->
      <div class="px-4 mt-20">
        {% if request.user.is_authenticated %}
        <div class="profile-info flex items-center rounded-xl bg-slate-800/50 transition-all">
          <div class="profile-avatar w-12 h-12 rounded-xl bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white font-bold mr-3">
            {{ request.user.username|first|upper }}
          </div>
          <div class="flex-1 min-w-0">
            <p class="font-semibold truncate">{{ request.user.username }}</p>
            <p class="text-slate-400 text-sm truncate">
              {{ request.user.role|title }}
            </p>
          </div>
          <a class="text-slate-400 hover:text-white" href="{% url 'logout' %}">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 flex-1 min-h-screen p-8 transition-all duration-300 bg-gray-900" id="mainContent">
    <!-- Content will be loaded here -->
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleBtn = document.getElementById("toggleBtn");
      const sidebar = document.querySelector(".sidebar");
      const mainContent = document.getElementById("mainContent");
      const submenuTriggers = document.querySelectorAll(".submenu-trigger");
      const navItems = document.querySelectorAll(".nav-item");

      // Sidebar toggle
      toggleBtn.addEventListener("click", function () {
        sidebar.classList.toggle("collapsed");
        if (sidebar.classList.contains("collapsed")) {
          mainContent.classList.add("ml-20");
          mainContent.classList.remove("ml-64");
        } else {
          mainContent.classList.remove("ml-20");
          mainContent.classList.add("ml-64");
        }
      });

      // Submenu toggle
      submenuTriggers.forEach((trigger) => {
        trigger.addEventListener("click", function () {
          const submenu = this.querySelector(".sub-menu");
          const icon = this.querySelector(".dropdown-icon");

          submenu.classList.toggle("open");
          icon.classList.toggle("rotate-180");

          // Close other submenus
          submenuTriggers.forEach((otherTrigger) => {
            if (otherTrigger !== trigger) {
              const otherSubmenu = otherTrigger.querySelector(".sub-menu");
              const otherIcon = otherTrigger.querySelector(".dropdown-icon");
              otherSubmenu.classList.remove("open");
              otherIcon.classList.remove("rotate-180");
            }
          });
        });
      });

      // Active nav item logic
      navItems.forEach((item) => {
        item.addEventListener("click", function () {
          navItems.forEach((i) => i.classList.remove("active"));
          this.classList.add("active");
        });
      });

      // Animate sidebar on load
      sidebar.classList.add("animate-slide-in");

      // Restore last visited content (if applicable)
      const hasVisited = localStorage.getItem("hasVisited");
      const lastPage = localStorage.getItem("lastPage");

      if (hasVisited && lastPage && window.htmx) {
        htmx.ajax("GET", lastPage, {
          target: "#mainContent",
          swap: "innerHTML",
        });
      }
    });

    // Store page visit and navigate using HTMX
    function navigateAndSave(el) {
      const url = el.getAttribute("data-url");
      if (url && window.htmx) {
        localStorage.setItem("lastPage", url);
        localStorage.setItem("hasVisited", "true");

        htmx.ajax("GET", url, {
          target: "#mainContent",
          swap: "innerHTML",
        });
      }
    }
  </script>
</div>
{% endblock %}
